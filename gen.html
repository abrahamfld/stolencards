<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Payload CMS - Add Credit Card</title>
</head>
<body>
  <h1>Payload CMS Credit Card Saver</h1>
  <button id="saveCardBtn">Save Credit Card</button>
  <pre id="output"></pre>

  <script>
    const payloadURL = 'http://localhost:3000'; // Change if hosted elsewhere
    const credentials = {
      email: 'admin@admin.com',
      password: '1234'
    };

    const cardData = {
      type: "Discover",
      number: "6011820412814146",
      expiry: "10/27",
      cvv: 597,
      balance: 1823.53,
      price: 19.33,
      country: "France",
      ownerName: "David Jones"
    };

    document.getElementById('saveCardBtn').addEventListener('click', async () => {
      const output = document.getElementById('output');

      try {
        // Step 1: Log in and get token
        const loginRes = await fetch(`${payloadURL}/api/users/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(credentials),
        });

        if (!loginRes.ok) {
          throw new Error(`Login failed: ${loginRes.status}`);
        }

        const loginData = await loginRes.json();
        const token = loginData.token;

        // Step 2: Create the credit card record
        const createRes = await fetch(`${payloadURL}/api/credit-cards`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `JWT ${token}`,
          },
          body: JSON.stringify(cardData),
        });

        const createData = await createRes.json();

        if (!createRes.ok) {
          throw new Error(`Creation failed: ${JSON.stringify(createData)}`);
        }

        output.textContent = `Record created:\n${JSON.stringify(createData, null, 2)}`;
      } catch (err) {
        output.textContent = `Error:\n${err.message}`;
      }
    });
  </script>
</body>
</html>
